<!-- feature search template begin -->
<ng-template #searchFeaturesTable>
  <form nz-form [formGroup]="searchFeatureForm" (submit)="getFeaturesAndCount(1)">
    <div nz-row nzGutter="24">
      <div nz-col nzSm="12" nzMd="8" nzLg="6">
        <nz-form-item>
          <nz-form-label nzFor="search-code">代码</nz-form-label>
          <nz-form-control>
            <input
              id="search-code"
              nz-input
              formControlName="code"
              placeholder="请输入查询的代码"
            />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col nzSm="12" nzMd="8" nzLg="6">
        <nz-form-item>
          <nz-form-label nzFor="search-name">名称</nz-form-label>
          <nz-form-control>
            <input
              id="search-name"
              nz-input
              formControlName="name"
              placeholder="请输入查询的名称"
            />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div
        nz-col
        [nzSm]="{ span: 12, push: 12 }"
        [nzMd]="{ span: 8, push: 0 }"
        [nzLg]="{ span: 6, push: 6 }"
      >
        <nz-form-item class="flr">
          <nz-space>
            <nz-space-item>
              <button type="button" nz-button nzType="default" (click)="reset()">
                重置
              </button>
            </nz-space-item>
            <nz-space-item>
              <button type="button" nz-button nzType="primary" (click)="search()">搜索</button>
            </nz-space-item>
          </nz-space>
        </nz-form-item>
      </div>
    </div>
  </form>
</ng-template>
<!-- feature search template end -->

<!-- feature list template begin -->
<nz-table
  #featuresTable
  [nzTitle]="searchFeaturesTable"
  [nzLoading]="featuresLoading"
  [nzData]="features"
  [nzTotal]="featuresTotal"
  [(nzPageIndex)]="featuresPageNumber"
  [(nzPageSize)]="featuresPageSize"
  nzBordered
  nzSize="small"
  [nzFrontPagination]="false"
  nzShowSizeChanger
  nzHideOnSinglePage
  (nzPageIndexChange)="getFeaturesAndCount($event)"
  (nzPageSizeChange)="getFeaturesAndCount(featuresPageNumber, $event)"
>
  <thead>
    <tr>
      <th>id</th>
      <th>代码</th>
      <th>名称</th>
      <th class="tac" width="100">
        <nz-space>
          <nz-space-item>操作</nz-space-item>
          <nz-space-item>
            <button
              nz-button
              nzType="primary"
              nzShape="circle"
              nzSize="small"
              nz-tooltip
              nzTooltipTitle="点击创建"
              (click)="openFeatureModal()"
            >
              <i nz-icon nzType="plus" nzTheme="outline"></i>
            </button>
          </nz-space-item>
        </nz-space>
      </th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let feature of featuresTable.data">
      <td>{{ feature.id }}</td>
      <td>{{ feature.code }}</td>
      <td>{{ feature.name }}</td>
      <td class="tac">
        <nz-space>
          <nz-space-item>
            <button
              nz-button
              nzType="primary"
              nzShape="circle"
              nzSize="small"
              nz-tooltip
              nzTooltipTitle="点击编辑"
              (click)="openFeatureModal(feature)"
            >
              <i nz-icon nzType="edit" nzTheme="outline"></i>
            </button>
          </nz-space-item>
          <nz-space-item>
            <button
              nz-button
              nzType="primary"
              nzShape="circle"
              nzSize="small"
              nzDanger
              nz-popconfirm
              [nzTitle]="messages.DELETE_CONFIRM"
              (nzOnConfirm)="deleteFeature(feature.id)"
              [nzLoading]="deletedFeatureId === feature.id"
              [disabled]="deletedFeatureId === feature.id"
              nz-tooltip
              nzTooltipTitle="点击删除"
            >
              <i nz-icon nzType="delete" nzTheme="outline"></i>
            </button>
          </nz-space-item>
        </nz-space>
      </td>
    </tr>
  </tbody>
</nz-table>
<!-- feature list template end -->

<!-- feature modal template begin -->
<nz-modal
  [(nzVisible)]="featureModalVisible"
  nzTitle="功能管理"
  [nzContent]="modalContent"
  [nzFooter]="modalFooter"
  (nzOnCancel)="closeFeatureModal()"
>
</nz-modal>
<ng-template #modalContent>
  <nz-content>
    <form nz-form [formGroup]="featureForm" (submit)="saveFeatureForm()">
      <nz-form-item>
        <nz-form-label nzSpan="4" nzFor="form-code" nzRequired>代码</nz-form-label>
        <nz-form-control nzSpan="20" nzValidateStatus nzHasFeedback>
          <input id="form-code" nz-input formControlName="code" placeholder="请输入代码" />
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzSpan="4" nzFor="form-name" nzRequired>名字</nz-form-label>
        <nz-form-control nzSpan="20" nzValidateStatus nzHasFeedback>
          <input id="form-name" nz-input formControlName="name" placeholder="请输入名字" />
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzSpan="4" nzFor="form-menu-ids">菜单</nz-form-label>
        <nz-form-control nzSpan="20" nzValidateStatus nzHasFeedback>
          <nz-tree-select
            id="form-menu-ids"
            formControlName="menuIds"
            [nzNodes]="menuOptions"
            nzMultiple
            nzAllowClear
            nzCheckable
            nzPlaceHolder="请选择菜单"
          >
          </nz-tree-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzSpan="4" nzFor="form-permission-ids">权限</nz-form-label>
        <nz-form-control nzSpan="20" nzValidateStatus nzHasFeedback>
          <nz-select
            id="form-permission-ids"
            formControlName="permissionIds"
            [nzOptions]="permissionOptions"
            nzMode="multiple"
            nzAllowClear
            nzPlaceHolder="请选择权限"
          >
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzSpan="4" nzFor="form-action-ids">接口</nz-form-label>
        <nz-form-control nzSpan="20" nzValidateStatus nzHasFeedback>
          <nz-select
            id="form-action-ids"
            formControlName="actionIds"
            [nzOptions]="actionOptions"
            nzMode="multiple"
            nzAllowClear
            nzPlaceHolder="请选择接口"
          >
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzSpan="4" nzFor="form-comment">备注</nz-form-label>
        <nz-form-control nzSpan="20" nzValidateStatus nzHasFeedback>
          <textarea
            id="form-comment"
            nz-input
            formControlName="comment"
            placeholder="请输入备注"
          ></textarea>
        </nz-form-control>
      </nz-form-item>
    </form>
  </nz-content>
</ng-template>
<ng-template #modalFooter>
  <button nz-button nzType="default" (click)="closeFeatureModal()">
    取消
  </button>
  <button
    nz-button
    nzType="primary"
    [disabled]="saveFeatureDisabled"
    [nzLoading]="saveFeatureLoading"
    (click)="saveFeatureForm()"
  >
    保存
  </button>
</ng-template>
<!-- feature modal template end -->
